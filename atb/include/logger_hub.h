#pragma once

// -----------------------------------------------------------------------------
// std
// -----------------------------------------------------------------------------
#include <vector>

// -----------------------------------------------------------------------------
// Logging.
// -----------------------------------------------------------------------------
#include "spdlog/spdlog.h"

// -----------------------------------------------------------------------------
// boost
// -----------------------------------------------------------------------------
#include <boost/thread.hpp>

namespace atb {

    const short max_log_lines = 16;
    const short log_line_length = 1024;

    // -------------------------------------------------------------------------
    // Central logger hub.
    // Switch for all log lines.
    // -------------------------------------------------------------------------
    class logger_hub {

    private:
        boost::mutex lock;

        // ---------------------------------------------------------------------
        // Actual logger.
        // ---------------------------------------------------------------------
        std::shared_ptr<spdlog::logger> console;

        // ---------------------------------------------------------------------
        // Keeps track lines that are free for use.
        // ---------------------------------------------------------------------
        std::vector<void*> free_log_lines;

    public:
        logger_hub();

        ~logger_hub();

        // ---------------------------------------------------------------------
        // Debug callback.
        // ---------------------------------------------------------------------
        void debug(const char* const message) noexcept;

        // ---------------------------------------------------------------------
        // Info callback.
        // ---------------------------------------------------------------------
        void info(const char* const message) noexcept;

        // ---------------------------------------------------------------------
        // Warning callback.
        // ---------------------------------------------------------------------
        void warn(const char* const message) noexcept;

        // ---------------------------------------------------------------------
        // Error callback.
        // ---------------------------------------------------------------------
        void error(const char* const message) noexcept;

        // ---------------------------------------------------------------------
        // Fatal callback.
        // ---------------------------------------------------------------------
        void fatal(const char* const message) noexcept;

        // ---------------------------------------------------------------------
        // Reserves log line.
        // ---------------------------------------------------------------------
        char* malloc_empty_log_line() noexcept;

        // ---------------------------------------------------------------------
        // Returns log line.
        // ---------------------------------------------------------------------
        void free_log_line(char* line) noexcept;
    };
}